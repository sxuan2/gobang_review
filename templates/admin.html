<!DOCTYPE html>
<html>
<head>
    <title>åå°ç®¡ç†</title>
    <style>
        body { font-family: sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; background: #f9f9f9; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: left; }
        .form-box { background: white; padding: 20px; border: 1px solid #ddd; margin-bottom: 20px; }
        .btn-del { color: red; border: none; background: none; cursor: pointer; text-decoration: underline; }
        /* æ·»åŠ åˆ° style æ ‡ç­¾å†… */
        .user-bar {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 14px;
            color: #555;
            background: rgba(255,255,255,0.8);
            padding: 5px 10px;
            border-radius: 20px;
        }
        .user-bar a {
            text-decoration: none;
            margin-left: 10px;
            color: #007bff;
            font-weight: bold;
        }
        .user-bar a.danger { color: #dc3545; }
    
    </style>
</head>
<body>
    <div class="user-bar">
        ğŸ‘¤ {{ current_user.username }}
        {% if current_user.is_admin %}
            <a href="/admin_panel">âš™ï¸ åå°ç®¡ç†</a>
        {% endif %}
        <a href="/logout" class="danger">é€€å‡ºç™»å½•</a>
    </div>

    <h1>ğŸ‘¥ ç”¨æˆ·ç®¡ç†åå°</h1>
    <a href="/lobby">è¿”å›å¤§å…</a>
    
    <div class="form-box">
        <h3>æ·»åŠ æ–°ç”¨æˆ·</h3>
        {% with messages = get_flashed_messages() %}
            {% if messages %}<p style="color:green">{{ messages[0] }}</p>{% endif %}
        {% endwith %}
        <form method="POST">
            <input type="text" name="username" placeholder="ç”¨æˆ·å" required>
            <input type="text" name="password" placeholder="åˆå§‹å¯†ç " required>
            <button type="submit">åˆ›å»ºç”¨æˆ·</button>
        </form>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>ç”¨æˆ·å</th>
                <th>è§’è‰²</th>
                <th>æ“ä½œ (æ…é‡)</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u.id }}</td>
                <td>{{ u.username }}</td>
                <td>{{ 'ç®¡ç†å‘˜' if u.is_admin else 'æ™®é€šç”¨æˆ·' }}</td>
                <td>
                    <form action="/api/reset_password" method="POST" style="display:inline-block; margin-right:10px;">
                        <input type="hidden" name="user_id" value="{{ u.id }}">
                        <input type="text" name="new_password" placeholder="æ–°å¯†ç " style="width:80px; padding:2px; font-size:12px;">
                        <button style="padding:2px 5px; font-size:12px; background:#ffc107; color:black;">é‡ç½®</button>
                    </form>

                    {% if not u.is_admin %}
                    <form action="/api/delete_user/{{ u.id }}" method="POST" style="display:inline-block;" onsubmit="return confirm('ç¡®å®šåˆ é™¤è¯¥ç”¨æˆ·å—?')">
                        <button class="btn-del">åˆ é™¤</button>
                    </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</body>
</html>